---
export interface Props {
  title: string;
  description: string[];
  images: string[];
  video?: {
    platform: "vimeo" | "youtube" | "facebook";
    id: string;
    title?: string;
    aspectRatio?: string;
    notEmbeddable?: boolean;
    facebookUrl?: string;
  };
}

const { title, description, images, video } = Astro.props;

function getVideoEmbedUrl(platform: string, id: string): string {
  switch (platform) {
    case "vimeo":
      return `https://player.vimeo.com/video/${id}?h=${id}`;
    case "youtube":
      return `https://www.youtube.com/embed/${id}`;
    case "facebook":
      return `https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(id)}`;
    default:
      return "";
  }
}

function getAspectRatioValue(aspectRatio?: string): string {
  if (!aspectRatio) return "16/9";
  if (/^\d+\/\d+$/.test(aspectRatio)) return aspectRatio;
  return "16/9";
}
---

<div class="max-w-6xl mx-auto px-6 py-12">
  <div class="flex items-center mb-6 relative">
    <button
      type="button"
      onclick="window.history.back()"
      class="cursor-pointer hover:opacity-70 text-black font-bold transition-colors"
      aria-label="Go back"
    >
      ‚Üê Back
    </button>
    <h1
      class="flex-1 text-lg mr-16 font-extrabold text-black uppercase tracking-wide text-center"
    >
      {title}
    </h1>
  </div>

  {
    video && (
      <div class="mb-12 flex justify-center">
        {video.notEmbeddable && images && images.length > 0 ? (
          <div
            class="relative overflow-hidden w-full flex justify-center items-center"
            style={{
              aspectRatio: getAspectRatioValue(video.aspectRatio),
              maxWidth:
                video.aspectRatio === "9/16"
                  ? "420px"
                  : video.aspectRatio === "4/4"
                    ? "600px"
                    : "900px",
              width: "100%",
            }}
          >
            <img
              src={images[0]}
              alt={title + " thumbnail"}
              class="w-full h-full object-cover filter blur-md scale-105"
              style="position:absolute;inset:0;z-index:0;"
            />
            <a
              href={video.facebookUrl || video.id}
              target="_blank"
              rel="noopener noreferrer"
              class="z-10 px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-lg hover:bg-blue-700 transition-all flex items-center gap-2"
              style="position:relative;"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                viewBox="0 0 24 24"
                width="24"
                height="24"
              >
                <path d="M22.675 0h-21.35C.595 0 0 .592 0 1.326v21.348C0 23.408.595 24 1.325 24h11.495v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.797.143v3.24l-1.918.001c-1.504 0-1.797.715-1.797 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116C23.406 24 24 23.408 24 22.674V1.326C24 .592 23.406 0 22.675 0" />
              </svg>
              Watch on Facebook
            </a>
          </div>
        ) : (
          <div
            class="overflow-hidden w-full"
            style={{
              aspectRatio: getAspectRatioValue(video.aspectRatio),
              maxWidth:
                video.aspectRatio === "9/16"
                  ? "420px"
                  : video.aspectRatio === "4/4"
                    ? "600px"
                    : "900px",
              width: "100%",
            }}
          >
            <iframe
              title={video.title || `${title} video`}
              src={getVideoEmbedUrl(video.platform, video.id)}
              width="100%"
              height="100%"
              referrerpolicy="strict-origin-when-cross-origin"
              allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
              allowfullscreen
              class="w-full h-full"
            />
          </div>
        )}
      </div>
    )
  }

  {
    description.length > 0 ? (
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
        <div class="space-y-4">
          {description.map((paragraph) => (
            <p class="text-black text-base font-bold leading-relaxed">
              {paragraph}
            </p>
          ))}
        </div>
        <div class="grid grid-cols-2 gap-4">
          {images.map((imageSrc, index) => (
            <div class="aspect-square overflow-hidden relative">
              <img
                src={imageSrc}
                alt={`${title} - Image ${index + 1}`}
                class="w-full h-full object-cover"
              />
            </div>
          ))}
        </div>
      </div>
    ) : (
      <div class="grid grid-cols-4 gap-4">
        {images.map((imageSrc, index) => (
          <div class="aspect-square overflow-hidden relative">
            <img
              src={imageSrc}
              alt={`${title} - Image ${index + 1}`}
              class="w-full h-full object-cover"
            />
          </div>
        ))}
      </div>
    )
  }
</div>
